---
title: "RedLine Infostealer"
classes: wide
header:
  teaser: /assets/images/malware-analysis/Redline/thumbnail.png
ribbon: DodgerBlue
description: "Teeeeeeest ttttttttttttteeeeeeeeeessssssssst ttttttttttttttteeeeeeeeeeeeesssssssst teeeeeeeeeeesssssssst test ..."
categories:
  - Malware Analysis
toc: true
---
# RedLine in a Nutshell

RedLine is a newly emerging infostealer. An *infostealer malware* is designed to gather information from an infected system. The most common form of infostealer is to gather login information, like usernames and passwords. RedLine was first being noticed at 2020 via COVID-19 phishing emails, and has been active in 2021. RedLine is almost everywhere and has appeared variously as Trojanized services, games, and cracks. The RedLine malware family has been distributed and sold mostly via Russian underground malware forums. This threat has been sold as individual packages with several pricing options, or as **Malware-as-a-Service (MaaS)** on a subscription-based pricing package. Many samples of RedLine also appear with legit-looking digital certificates. RedLine is sdfasd fasdfkjaskdjf asdhfjashdfjkasdhflkj, therefore u must protect your organiszation. 



# RedLine Infection Vector

RedLine is extremely versatile and has been noted being delivered by numerous mechanisms. It is used in multiple smaller campaigns by individuals who have purchased the malware online. Due to this, there are a wide range of known infection vectors. Only few of them are stated below:

- Trojanized as popular services: Telegram, Signal, Discord, Signal.
- Email phishing campaigns.
- Abusing Google Ads hosting Trojanized websites.
- Social engineering campaigns to attack digital artists using Non-Fungible Tokens.
- Downloaded by malware loaders.




# Technical Summary

1. **Configuration Extraction:** RedLine comes with embedded configuration which is <u>Base64</u> encoded plus an additional layer of <u>XOR</u> encryption with hard-coded key. These configuration contains the C&C server which it will communicate with to exfiltrate gathered information and also for further commands.
2. **C2 Communication:** After extracting the C&C and before doing anything, RedLine will check if there is a possibility to reach its C&C server in order to begin its true functionality. If there is an available connection, RedLine will then try to obtain the malicious <u>Scan Settings</u>. These scan arguments contain flags that will be used to determine which information to be stolen. Moreover, the obtained scan arguments contain tuning parameters to specify desired data assets. For instance, specified files to be exfiltrated ...etc.    
3. **Host Profiling:** RedLine will gather information about the infected host in order to decide further actions. Mostly relying on <u>Windows Management Instrumentation (WMI)</u>, it harvests and generates the following information: Hardware ID, Malware Release ID, username, OS version, Installed languages, Installed programs, Current running processes, Anti-malware products, Screen size & resolution, Total size of RAM, Graphics card info, Processor's info, Victim's country, Location, Timezone, IP address, Postal code. In addition to all these, RedLine contains functions to exclude Blacklisted countries as well as Blocked IPs from infection.
4. **Information Stealing:** Here lies the bulk of its functionality. As being information stealer, based on the obtained scan arguments, RedLine can exfiltrates the following information:
   - <u>Files:</u> Specified files in the directories: `ProgramData, Program Files, Program Files (x86)`.
   - <u>Browsers:</u> Login credentials, Cookies, Auto-fill fields used by websites, and Credit card details.
   - <u>Crypto Wallets:</u> Credentials of: Armory, Exodus, Ethereum, Monero, Atomic, BinanceChain ...etc.
   - <u>VPN Clients:</u> Credentials of the following VPN clients: NordVPN, ProtonVPN, and OpenVPN.
   - <u>Gaming Clients:</u> It's targeting the credentials of the famous Steam gaming client by Valve corp.
   - <u>Instant Messengers:</u> Currently it's targeting Telegram session data and Discord tokens.
   - <u>FTP Clients:</u> Credentials of the free FTP client FileZilla.
5. **Remote Execution:** After successful data exfiltration, RedLine will try to obtain additional commands to execute within the infected machine. RedLine currently is able to do the following:
   - Download additional files.
   - Download and execute PE files.
   - Open specified link.
   - Execute commands via `CMD.exe` .








# Technical Analysis 

## First look & Unpacking

[![](/assets/images/malware-analysis/Redline/virus_total.png)](/assets/images/malware-analysis/Redline/virus_total.png)
<center><font size="3"> <u>Figure</u>(1): <u>Results are at 2021-09-20 18:03:15 UTC. Different results may appear. </u> </font></center> 
<br>
This sample comes -in disguise- as packed C/C++ file which will be responsible to unpack and expose the real RedLine malware. However, the initial packed file as you can see in the last figure is flagged malicious by 20 security vendors according to [VirusTotal](https://www.virustotal.com/gui/file/1d91ab82e01d7682deecbeef7b441f26e405c0053e0354e92fdb5cfe61b097b0/detection/f-1d91ab82e01d7682deecbeef7b441f26e405c0053e0354e92fdb5cfe61b097b0-1632160995).
For simplicity sake, I've decided to use [UnpacMe](https://www.unpac.me/results/159ed23f-5cdf-4183-8131-d95e61932a9d#/) to do the unpacking process. The final unpacked file is found to a .NET application which is the real RedLine malware that I will analyze in details.



## Configuration Extraction

```c#
public EntryPoint()
	{
		NativeHelper.Hide();	//Hides the malware UI components.
		this.IP = "CCYCQCQDMRAtBkYfOgFdDScnDEQoHj1dOS0qeA==";
		this.ID = "JjUjBzE+JhkBIk9Y";
		this.Message = "";
		this.Key = "Erethitic";	//Hard-coded Key
		this.Version = 1;
	}
```

RedLine begins with hiding its UI from the victim user. It dynamically resolves `GetConsoleWindow()` and `ShowWindow()` APIs do that. RedLine calls `ShowWindow()` with the `SW_HIDE` parameter = 0 to effectively hide its window.

```c#
public static string Decrypt(string b64, string stringKey)
	{
		string result;
		try
		{
			if (string.IsNullOrWhiteSpace(b64))
			{
				result = string.Empty;
			}
			else
			{
				result = StringDecrypt.FromBase64(StringDecrypt.Xor(StringDecrypt.FromBase64(b64), stringKey));
			}
		}
		catch
		{
			result = b64;
		}
		return result;
	}
```

Then, it uses the `Decrypt()` function to extract the embedded encrypted configuration. For this particular sample: the decrypted C&C is `IP="188.124.36.242:25802"` and the decrypted malware release ID is `ID="paladin"`.




























# Conclusion



# IoCs





# YARA Rule





# Python Automated Configuration Extraction 




# Refrences